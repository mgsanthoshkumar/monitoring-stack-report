<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring Stack - Project Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- 
      Chosen Palette: Calm Harmony (Amber, Emerald, Slate)
      Application Structure Plan: A tabbed SPA (Home, Phase 1-4) was chosen over a linear document. The "Home" tab provides a high-level summary (final architecture & error analysis chart). Each "Phase" tab presents the objective and an interactive accordion-style troubleshooting log (Problem -> Click to reveal Solution). This structure allows users to quickly navigate to a specific project phase and explore the key challenges and learnings interactively, which is more effective for a debugging report than a static table.
      Visualization & Content Choices: Report Info: 4 Phases of debugging. Goal: Summarize challenges. Viz: Donut Chart (Chart.js/Canvas). Interaction: Tooltip on hover. Justification: Provides an 'at-a-once' summary of error types (e.g., "Configuration Error," "Network Error"), which is more insightful than a simple list. Report Info: Problem/Solution pairs per phase. Goal: Allow exploration. Viz: Interactive Accordion (HTML/CSS/JS). Interaction: Click to expand/collapse. Justification: Hides complexity and encourages user-driven exploration of the debugging process.
      CRITICAL: The LLM feature (AI Debug Assistant) is added to provide expert commentary on the main challenges of the currently visible phase.
      CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fefbec; /* amber-50 */
            color: #334155; /* slate-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 450px;
        }
        .tab-active {
            background-color: #059669; /* emerald-600 */
            color: #ffffff;
            font-weight: 600;
        }
        .tab-inactive {
            background-color: #ffffff;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s;
        }
        .tab-inactive:hover {
            background-color: #f3f4f6; /* gray-100 */
        }
        .accordion-toggle {
            background-color: #ffffff;
            border: 1px solid #e5e7eb; /* gray-200 */
            width: 100%;
            text-align: left;
            padding: 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            transition: background-color 0.2s;
        }
        .accordion-toggle:hover {
            background-color: #f9fafb; /* gray-50 */
        }
        .accordion-toggle.active {
            background-color: #ecfdf5; /* emerald-50 */
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }
        .accordion-content {
            padding: 1rem;
            border: 1px solid #e5e7eb; /* gray-200 */
            border-top: 0;
            background-color: #ffffff;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }
        .loading-animation {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #059669;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">
    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-emerald-800 mb-2">End-to-End Monitoring Stack Report</h1>
            <p class="text-xl text-slate-600">An interactive summary of the implementation and debugging process.</p>
        </header>

        <nav class="flex flex-wrap gap-2 mb-8">
            <button id="nav-home" class="tab-active px-4 py-2 rounded-md shadow-sm">Home</button>
            <button id="nav-phase-1" class="tab-inactive px-4 py-2 rounded-md shadow-sm">Phase 1</button>
            <button id="nav-phase-2" class="tab-inactive px-4 py-2 rounded-md shadow-sm">Phase 2</button>
            <button id="nav-phase-3" class="tab-inactive px-4 py-2 rounded-md shadow-sm">Phase 3</button>
            <button id="nav-phase-4" class="tab-inactive px-4 py-2 rounded-md shadow-sm">Phase 4</button>
        </nav>

        <main id="content-container">
            <!-- Home Page -->
            <div id="page-home" class="page-content space-y-8">
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-4">Project Overview</h2>
                    <p class="text-slate-600 leading-relaxed">
                        This report documents the four-phase implementation of a robust, scalable, and automated monitoring system. The project started with basic host monitoring and evolved into a production-ready stack featuring advanced alerting, long-term storage, and automated provisioning. This interactive dashboard summarizes the final architecture and the key challenges overcome during development.
                    </p>
                </section>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <section class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-emerald-700 mb-4">Final Architecture (8 Services)</h2>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                            <li><span class="font-semibold">Prometheus:</span> Core time-series database and alerting.</li>
                            <li><span class="font-semibold">Grafana:</span> Visualization and automated provisioning.</li>
                            <li><span class="font-semibold">Alertmanager:</span> Advanced alert routing and handling.</li>
                            <li><span class="font-semibold">Thanos Query:</span> Global query view for LTS.</li>
                            <li><span class="font-semibold">MinIO:</span> S3-compatible long-term storage backend.</li>
                            <li><span class="font-semibold">Node Exporter:</span> Gathers host-level health metrics.</li>
                            <li><span class="font-semibold">Blackbox Exporter:</span> Probes application-level health.</li>
                            <li><span class="font-semibold">Docker Compose:</span> Orchestrates all services.</li>
                        </ul>
                        <h3 class="text-lg font-semibold mt-6 mb-2">Verification Links:</h3>
                        <div class="flex flex-wrap gap-3">
                            <span class="inline-block bg-gray-100 rounded-md px-3 py-1 text-sm font-medium text-gray-800">Querying (Thanos): <code class="bg-gray-200 px-1 rounded">localhost:9091</code></span>
                            <span class="inline-block bg-gray-100 rounded-md px-3 py-1 text-sm font-medium text-gray-800">Alerting (Alertmanager): <code class="bg-gray-200 px-1 rounded">localhost:9093</code></span>
                            <span class="inline-block bg-gray-100 rounded-md px-3 py-1 text-sm font-medium text-gray-800">Visualization (Grafana): <code class="bg-gray-200 px-1 rounded">localhost:3000</code></span>
                        </div>
                    </section>
                    
                    <section class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-emerald-700 mb-4">Project Challenge Summary</h2>
                        <p class="text-slate-600 mb-4">A breakdown of all major errors encountered and resolved during the project, grouped by category.</p>
                        <div class="chart-container">
                            <canvas id="errorChart"></canvas>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Phase 1 Page -->
            <div id="page-phase-1" class="page-content hidden space-y-6">
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-2">Phase 1: Basic Monitoring Stack Setup</h2>
                    <p class="text-slate-600">**Objective:** Establish core metric collection (Node Exporter) and visualization (Grafana) for host health (CPU, Memory).</p>
                </section>
                
                <section class="bg-white p-6 rounded-lg shadow-md space-y-4">
                    <h3 class="text-xl font-semibold text-emerald-700">AI Debug Assistant ✨</h3>
                    <button id="analyze-1" class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg shadow-md transition duration-150 flex items-center justify-center space-x-2">
                        <span id="analyze-text-1">Analyze Phase 1 Challenges</span>
                        <div id="loading-1" class="loading-animation hidden"></div>
                    </button>
                    <div id="ai-insight-1" class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg text-slate-700 min-h-[50px]">
                        Click 'Analyze Challenges' to get a concise summary of this phase's main debugging theme.
                    </div>
                </section>

                <section class="accordion-container">
                    <h3 class="text-xl font-semibold mb-4">Troubleshooting Log</h3>
                    <div class="space-y-4">
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Port 9090 Already Allocated
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p1-1">Learned to diagnose and resolve host port conflicts using `sudo lsof -i :port`. This is often caused by lingering or failed container proxies from previous `docker compose` attempts.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> PromQL Syntax Error
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p1-2">Discovered the correct PromQL structure for Grafana, especially for combining metric names, label filters (`{mode="idle"}`), and aggregation functions like `avg by (instance) (irate(...))`. Simple syntax errors (`unexpected identifier "idle"`) can stop visualization.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Panel Saved as New Dashboard
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p1-3">Understood the distinction in the Grafana UI between "adding a panel" to an *existing* dashboard versus "saving a panel" as a *new* dashboard entity, which led to a fragmented setup.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Phase 2 Page -->
            <div id="page-phase-2" class="page-content hidden space-y-6">
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-2">Phase 2: Advanced Visibility (Blackbox Exporter)</h2>
                    <p class="text-slate-600">**Objective:** Expand monitoring from internal host health to external application-level health (Uptime, Latency).</p>
                </section>

                <section class="bg-white p-6 rounded-lg shadow-md space-y-4">
                    <h3 class="text-xl font-semibold text-emerald-700">AI Debug Assistant ✨</h3>
                    <button id="analyze-2" class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg shadow-md transition duration-150 flex items-center justify-center space-x-2">
                        <span id="analyze-text-2">Analyze Phase 2 Challenges</span>
                        <div id="loading-2" class="loading-animation hidden"></div>
                    </button>
                    <div id="ai-insight-2" class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg text-slate-700 min-h-[50px]">
                        Click 'Analyze Challenges' to get a concise summary of this phase's main debugging theme.
                    </div>
                </section>

                <section class="accordion-container">
                    <h3 class="text-xl font-semibold mb-4">Troubleshooting Log</h3>
                    <div class="space-y-4">
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Node Exporter DOWN (DNS Lookup Failed)
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p2-1">Encountered a critical conflict between Docker's internal container networking and using `network_mode: host`. When a container uses `network_mode: host`, it's no longer on the Docker bridge network and cannot be reached by its service name. The fix was to make Prometheus target `localhost:9100` instead of `node-exporter:9100`.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Node Exporter DOWN (Connection Refused)
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p2-2">After fixing the DNS lookup, a `connection refused` error indicated the problem was external to Docker. This identified that host-level security (Firewall, SELinux) was blocking the port, even though the configuration was correct.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-green-700 font-bold mr-2">FINAL FIX:</span> Switched Node Exporter to Bridge Network
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p2-3">When `network_mode: host` is blocked by restrictive host security policies (like SELinux), the definitive solution is to revert the container to the default Docker Bridge Network. This allows containers (like Prometheus and Node Exporter) to communicate internally using their service names, bypassing the host's security rules.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Phase 3 Page -->
            <div id="page-phase-3" class="page-content hidden space-y-6">
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-2">Phase 3: Advanced Alerting & Long-Term Storage (LTS)</h2>
                    <p class="text-slate-600">**Objective:** Implement reliable notification routing (Alertmanager) and scalable data archival (Thanos & MinIO).</p>
                </section>

                <section class="bg-white p-6 rounded-lg shadow-md space-y-4">
                    <h3 class="text-xl font-semibold text-emerald-700">AI Debug Assistant ✨</h3>
                    <button id="analyze-3" class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg shadow-md transition duration-150 flex items-center justify-center space-x-2">
                        <span id="analyze-text-3">Analyze Phase 3 Challenges</span>
                        <div id="loading-3" class="loading-animation hidden"></div>
                    </button>
                    <div id="ai-insight-3" class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg text-slate-700 min-h-[50px]">
                        Click 'Analyze Challenges' to get a concise summary of this phase's main debugging theme.
                    </div>
                </section>

                <section class="accordion-container">
                    <h3 class="text-xl font-semibold mb-4">Troubleshooting Log</h3>
                    <div class="space-y-4">
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Dependency Cycle Detected
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p3-1">Learned that Docker Compose dependency graphs (`depends_on`) cannot be circular. We had `alertmanager` depending on `prometheus` and `prometheus` depending on `alertmanager`. The fix was to remove the non-essential dependency from Alertmanager.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Prometheus "No rules found"
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p3-2">Discovered that telling Prometheus to load a rule file (`rule_files: ...` in `prometheus.yml`) is not enough. The rule file must also be *physically mounted* into the container's filesystem using a `volume` entry in `docker-compose.yaml`.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> MinIO Image Not Found (Manifest Unknown)
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p3-3">Relying on the `:latest` image tag for complex, multi-architecture images like Thanos is unreliable. The `:latest` manifest was not found. The fix was to specify a known, stable version tag (e.g., `v0.34.1`) in `docker-compose.yaml`.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> MinIO Port 9001 Already Allocated
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p3-4">Encountered a persistent port conflict that survived container restarts. This indicated a deep OS-level port lock. The most effective solution (after `lsof` and `kill` failed) was to change the host-exposed port in `docker-compose.yaml` (from `9001` to `9011`) to bypass the conflict entirely.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Phase 4 Page -->
            <div id="page-phase-4" class="page-content hidden space-y-6">
                <section class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-2">Phase 4: Scaling & Automation</h2>
                    <p class="text-slate-600">**Objective:** Make the monitoring stack reproducible and dynamically manageable using automated provisioning.</p>
                </section>

                <section class="bg-white p-6 rounded-lg shadow-md space-y-4">
                    <h3 class="text-xl font-semibold text-emerald-700">AI Debug Assistant ✨</h3>
                    <button id="analyze-4" class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-lg shadow-md transition duration-150 flex items-center justify-center space-x-2">
                        <span id="analyze-text-4">Analyze Phase 4 Challenges</span>
                        <div id="loading-4" class="loading-animation hidden"></div>
                    </button>
                    <div id="ai-insight-4" class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg text-slate-700 min-h-[50px]">
                        Click 'Analyze Challenges' to get a concise summary of this phase's main debugging theme.
                    </div>
                </section>

                <section class="accordion-container">
                    <h3 class="text-xl font-semibold mb-4">Troubleshooting Log</h3>
                    <div class="space-y-4">
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Grafana Provisioning Failed (Empty UI)
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p4-1">Identified the root cause of empty dashboards and data sources: the host provisioning directories (`./grafana/provisioning/...`) defined in `docker-compose.yaml` had not been created on the host machine, so the mounts were empty.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-red-700 font-bold mr-2">FAILURE:</span> Provisioning Still Fails (Volume Lock)
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p4-2">After fixing paths, the provisioning still failed. This was due to file permission errors (`chmod 777` needed) and Docker volume caching, which locked Grafana into a failed state even after `docker compose down`.</p>
                            </div>
                        </div>
                        <div>
                            <button class="accordion-toggle">
                                <span class="text-green-700 font-bold mr-2">FINAL FIX:</span> Cleaned Grafana Volume
                            </button>
                            <div class="accordion-content hidden">
                                <h4 class="font-semibold text-lg mb-2">Key Learning Point:</h4>
                                <p id="p4-3">The definitive solution for failed Grafana provisioning is to force a clean start. This requires stopping the container, forcefully removing the locked container (`docker rm -f <id>`), and explicitly deleting the named volume (`docker volume rm monitoring-stack_grafana-data`). This forces Grafana to re-provision from the YAML files on the next startup.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        const API_KEY = ""; // Placeholder

        // Data structure to hold the content for the AI to analyze
        const phaseContent = {
            1: [
                document.getElementById('p1-1').textContent.trim(),
                document.getElementById('p1-2').textContent.trim(),
                document.getElementById('p1-3').textContent.trim(),
            ].join(' | '),
            2: [
                document.getElementById('p2-1').textContent.trim(),
                document.getElementById('p2-2').textContent.trim(),
                document.getElementById('p2-3').textContent.trim(),
            ].join(' | '),
            3: [
                document.getElementById('p3-1').textContent.trim(),
                document.getElementById('p3-2').textContent.trim(),
                document.getElementById('p3-3').textContent.trim(),
                document.getElementById('p3-4').textContent.trim(),
            ].join(' | '),
            4: [
                document.getElementById('p4-1').textContent.trim(),
                document.getElementById('p4-2').textContent.trim(),
                document.getElementById('p4-3').textContent.trim(),
            ].join(' | '),
        };

        async function callGeminiAPI(prompt, insightElement, analyzeButtonId, loadingElementId) {
            const loadingElement = document.getElementById(loadingElementId);
            const insightBox = document.getElementById(insightElement);
            const analyzeTextElement = document.getElementById(analyzeButtonId);

            // Set loading state
            loadingElement.classList.remove('hidden');
            analyzeTextElement.textContent = 'Analyzing...';
            insightBox.textContent = 'Generating expert summary, please wait...';

            const systemPrompt = "You are a senior DevOps Engineer specializing in Prometheus, Grafana, and Docker Compose. Your task is to analyze a list of debugging challenges for a specific phase of a project. Provide a concise, single-paragraph summary (3-4 sentences max) identifying the main theme or root cause category for the phase, and the single most critical learning point.";
            
            const userQuery = `Analyze the following debugging challenges encountered during a monitoring stack project phase. The challenges are separated by '|': ${prompt}`;
            
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            let responseData = null;
            let retries = 0;
            const maxRetries = 3;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        if (response.status === 429 && retries < maxRetries - 1) {
                            const delay = Math.pow(2, retries) * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            retries++;
                            continue;
                        }
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    responseData = await response.json();
                    break; 

                } catch (error) {
                    console.error('Fetch error:', error);
                    insightBox.textContent = 'Error during analysis: Could not connect to API.';
                    break;
                }
            }
            
            // Handle response
            loadingElement.classList.add('hidden');
            analyzeTextElement.textContent = 'Analyze Challenges';

            if (responseData && responseData.candidates && responseData.candidates[0] && responseData.candidates[0].content.parts[0].text) {
                insightBox.textContent = responseData.candidates[0].content.parts[0].text;
            } else if (insightBox.textContent === 'Generating expert summary, please wait...') {
                // If it was still loading text but failed, display a generic error
                insightBox.textContent = 'Analysis failed. Check console for details or try again.';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const navButtons = {
                'nav-home': document.getElementById('nav-home'),
                'nav-phase-1': document.getElementById('nav-phase-1'),
                'nav-phase-2': document.getElementById('nav-phase-2'),
                'nav-phase-3': document.getElementById('nav-phase-3'),
                'nav-phase-4': document.getElementById('nav-phase-4'),
            };

            const contentPages = {
                'page-home': document.getElementById('page-home'),
                'page-phase-1': document.getElementById('page-phase-1'),
                'page-phase-2': document.getElementById('page-phase-2'),
                'page-phase-3': document.getElementById('page-phase-3'),
                'page-phase-4': document.getElementById('page-phase-4'),
            };
            
            const analysisButtons = {
                1: document.getElementById('analyze-1'),
                2: document.getElementById('analyze-2'),
                3: document.getElementById('analyze-3'),
                4: document.getElementById('analyze-4'),
            };

            function showPage(pageId) {
                // Hide all pages
                Object.values(contentPages).forEach(page => {
                    if (page) page.classList.add('hidden');
                });
                
                // Deactivate all buttons
                Object.values(navButtons).forEach(button => {
                    if (button) {
                        button.classList.remove('tab-active');
                        button.classList.add('tab-inactive');
                    }
                });

                // Show target page
                const targetPage = contentPages[pageId];
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                }
                
                // Activate target button
                const targetButton = navButtons['nav-' + pageId.split('-')[1]];
                if (targetButton) {
                    targetButton.classList.add('tab-active');
                    targetButton.classList.remove('tab-inactive');
                }
            }

            // Init navigation
            Object.keys(navButtons).forEach(buttonId => {
                const button = navButtons[buttonId];
                if (button) {
                    button.addEventListener('click', () => {
                        const pageId = 'page-' + buttonId.split('-')[1];
                        showPage(pageId);
                    });
                }
            });

            // Init accordions
            function initAccordions() {
                const accordions = document.querySelectorAll('.accordion-toggle');
                accordions.forEach(button => {
                    button.addEventListener('click', () => {
                        const content = button.nextElementSibling;
                        button.classList.toggle('active');
                        content.classList.toggle('hidden');
                    });
                });
            }

            // Init AI Analysis buttons
            Object.keys(analysisButtons).forEach(phase => {
                const button = analysisButtons[phase];
                if (button) {
                    button.addEventListener('click', () => {
                        const content = phaseContent[phase];
                        const insightElement = `ai-insight-${phase}`;
                        const analyzeButtonId = `analyze-text-${phase}`;
                        const loadingElementId = `loading-${phase}`;
                        callGeminiAPI(content, insightElement, analyzeButtonId, loadingElementId);
                    });
                }
            });

            // Init error summary chart
            function initHomeChart() {
                const ctx = document.getElementById('errorChart');
                if (!ctx) return;
                
                const errorData = {
                    labels: [
                        'Network & Port Conflicts',
                        'Configuration & Syntax Errors',
                        'Permissions & Volume Mounts',
                        'Dependency & Image Issues',
                    ],
                    datasets: [{
                        label: 'Error Categories Encountered',
                        data: [
                            4, // Port 9090, 9001, node-exporter (host), node-exporter (bridge)
                            3, // PromQL syntax, rules.yml (missing), Grafana provisioning (missing dirs)
                            3, // rules.yml (is a dir), Grafana permissions, Grafana volume lock
                            2, // Docker dependency cycle, Thanos image (manifest unknown)
                        ],
                        backgroundColor: [
                            '#f97316', // orange-500
                            '#059669', // emerald-600
                            '#ef4444', // red-500
                            '#64748b', // slate-500
                        ],
                        hoverOffset: 4
                    }]
                };

                new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: errorData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed;
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    },
                });
            }

            // Initial load
            showPage('page-home');
            initHomeChart();
            initAccordions();
        });
    </script>
</body>
</html>
